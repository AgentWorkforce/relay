{"id":"bd-log1","title":"Add DIY minimal logging to agent-relay daemon","description":"Implement a lightweight ~20-line logging approach for the agent-relay daemon. No external library needed.\n\nRequirements:\n- log_info(), log_warn(), log_error(), log_debug() functions\n- JSON output format for easy parsing with jq\n- Configurable via LOG_FILE and DEBUG env vars\n- Log daemon startup/shutdown\n- Log errors (delivery failures, connection issues)\n- Debug-only message delivery logging\n- Minimal performance impact (sub-5ms system)\n\nImplementation:\n```bash\n_log() {\n    local level=\"$1\" msg=\"$2\"\n    local ts=$(date -u +\"%Y-%m-%dT%H:%M:%SZ\")\n    printf '{\"ts\":\"%s\",\"level\":\"%s\",\"msg\":\"%s\"}\\n' \"$ts\" \"$level\" \"$msg\" >> \"$LOG_FILE\"\n    [[ \"$LOG_STDOUT\" == \"1\" ]] && echo \"[$level] $msg\"\n}\n\nlog_info()  { _log \"INFO\"  \"$1\"; }\nlog_warn()  { _log \"WARN\"  \"$1\"; }\nlog_error() { _log \"ERROR\" \"$1\"; }\nlog_debug() { [[ \"${DEBUG:-0}\" == \"1\" ]] && _log \"DEBUG\" \"$1\"; }\n```\n\nFiles modified:\n- src/utils/logger.ts (new file - TypeScript implementation)\n- src/daemon/server.ts (integrated logging)\n- src/utils/index.ts (exported logger)","priority":50,"status":"closed","created_at":"2026-01-01T07:40:00Z","closed_at":"2026-01-01T07:46:00Z","closed_reason":"Implemented TypeScript version with JSON output, configurable log levels, file logging support","tags":["logging","infrastructure","low-priority"]}
{"id":"bd-custom-cmd1","title":"Custom Relay Commands - Implementation Approach Decision","description":"Allow users to define custom command patterns that trigger code execution when agents output them.\n\nSpec: docs/proposals/custom-commands.md\n\nDecision Required: Which implementation approach?\n\n| Option | Complexity | Flexibility | Time to MVP |\n|--------|------------|-------------|-------------|\n| A. Script Directory | Low | Low | 1-2 days |\n| B. YAML Config | Medium | High | 3-5 days |\n| C. TypeScript | High | Very High | 1-2 weeks |\n| D. Hybrid (A→B) | Low→Medium | Progressive | 2 days + iterate |\n\nRecommendation: Option D (Hybrid)\n- Ship script directory first (works immediately)\n- Add YAML config based on user feedback\n- TypeScript handlers as future enhancement\n\nUse Cases:\n- DevOps: ->deploy:staging, ->rollback:prod\n- Integrations: ->jira:create, ->slack:#team\n- Testing: ->test:unit, ->lint:fix\n- Agent Coordination: ->assign:Alice, ->handoff:Bob","priority":70,"status":"open","created_at":"2026-01-04T10:00:00Z","tags":["feature","extensibility","decision-required"]}
{"id":"bd-oauth-callback","title":"Local OAuth callback server for cloud link","description":"Implement a local HTTP server for OAuth callback during `agent-relay cloud link`.\n\n## Current Flow (manual copy/paste)\n1. User runs `agent-relay cloud link`\n2. CLI opens browser to cloud auth URL\n3. User authenticates with GitHub OAuth in browser\n4. Cloud UI displays API key\n5. User manually copies API key\n6. User pastes key into CLI prompt\n7. CLI saves to ~/.local/share/agent-relay/cloud-config.json\n\n## Desired Flow (automatic)\n1. User runs `agent-relay cloud link`\n2. CLI starts local HTTP server on localhost:PORT\n3. CLI opens browser to cloud auth URL with callback param\n4. User authenticates with GitHub OAuth\n5. Cloud redirects to localhost:PORT/callback?token=...\n6. Local server receives token, saves config, closes\n7. CLI confirms success\n\n## Implementation\n- Start express/http server on random available port (e.g., 19284-19384 range)\n- Register callback URL with cloud: `http://localhost:PORT/callback`\n- Handle GET /callback with token extraction\n- Timeout after 5 minutes if no callback received\n- Graceful fallback to manual flow if port unavailable\n\n## Files to modify\n- src/cli/index.ts - cloud link command (lines 1649-1778)\n- May need cloud API changes to support localhost callbacks\n\n## Security considerations\n- Only bind to localhost (127.0.0.1)\n- Use state parameter to prevent CSRF\n- Short-lived callback server (closes after receiving token)\n- Validate token format before saving","priority":60,"status":"open","created_at":"2026-01-04T15:40:00Z","tags":["feature","ux","cloud","oauth"]}
