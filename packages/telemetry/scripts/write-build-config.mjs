import fs from 'node:fs';
import path from 'node:path';
import { fileURLToPath } from 'node:url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);
const packageRoot = path.resolve(__dirname, '..');
const outputPath = path.join(packageRoot, 'src', 'posthog-build-config.ts');

const buildApiKey = (
  process.env.POSTHOG_API_KEY ||
  ''
).trim();

const buildHost = (
  process.env.POSTHOG_HOST ||
  'https://us.i.posthog.com'
).trim() || 'https://us.i.posthog.com';

const output = `/**
 * Generated by packages/telemetry/scripts/write-build-config.mjs.
 * The publish pipeline injects these values from GitHub repository variables.
 */
export const BUILD_POSTHOG_API_KEY = ${JSON.stringify(buildApiKey)};
export const BUILD_POSTHOG_HOST = ${JSON.stringify(buildHost)};
`;

fs.writeFileSync(outputPath, output, 'utf8');
