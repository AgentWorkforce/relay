version: "1.0"
name: code-review
description: "Parallel multi-reviewer code assessment with consolidated findings."
swarm:
  pattern: fan-out
  maxConcurrency: 4
  timeoutMs: 2400000
  channel: swarm-code-review
agents:
  - name: lead
    cli: claude
    role: "Aggregates review output and final recommendations"
  - name: reviewer-architecture
    cli: codex
    role: "Assesses architecture and maintainability"
    interactive: false
  - name: reviewer-correctness
    cli: claude
    role: "Assesses correctness and testing"
    interactive: false
  - name: reviewer-security
    cli: gemini
    role: "Assesses security posture and abuse resistance"
    interactive: false
workflows:
  - name: parallel-review
    description: "Run focused reviews in parallel and synthesize final guidance."
    onError: fail
    steps:
      - name: prepare-context
        agent: lead
        task: |
          Summarize change intent, impacted modules, and review priorities:
          {{task}}
        verification:
          type: output_contains
          value: REVIEW_CONTEXT_READY
      - name: architecture-pass
        agent: reviewer-architecture
        dependsOn: [prepare-context]
        task: |
          Review architecture, coupling, and long-term maintainability:
          {{steps.prepare-context.output}}
        verification:
          type: output_contains
          value: ARCH_REVIEW_COMPLETE
      - name: correctness-pass
        agent: reviewer-correctness
        dependsOn: [prepare-context]
        task: |
          Review behavior, tests, and likely regression paths:
          {{steps.prepare-context.output}}
        verification:
          type: output_contains
          value: CORRECTNESS_REVIEW_COMPLETE
      - name: security-pass
        agent: reviewer-security
        dependsOn: [prepare-context]
        task: |
          Review attack surface, secret handling, and input validation:
          {{steps.prepare-context.output}}
        verification:
          type: output_contains
          value: SECURITY_REVIEW_COMPLETE
      - name: consolidate
        agent: lead
        dependsOn: [architecture-pass, correctness-pass, security-pass]
        task: |
          Produce merged findings, severity levels, and final recommendation.
        verification:
          type: output_contains
          value: DONE
coordination:
  barriers:
    - name: reviews-complete
      waitFor: [architecture-pass, correctness-pass, security-pass]
      timeoutMs: 900000
  consensusStrategy: majority
state:
  backend: memory
  ttlMs: 21600000
  namespace: code-review
errorHandling:
  strategy: fail-fast
  notifyChannel: swarm-code-review
