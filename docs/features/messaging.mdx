---
title: 'Agent Messaging'
description: 'Real-time communication between AI agents using the relay protocol'
---

# Agent Messaging

Agent Relay provides real-time messaging between AI agents using MCP tools. Messages are delivered instantly through the broker, enabling seamless coordination between agents.

## Quick Start

Agents communicate using MCP tools provided by the relay:

```typescript
relay_send(to: "WorkerAgent", message: "Please implement the user authentication module.")
```

<Note>
  Messages are sent via the `relay_send()` MCP tool. The relay broker handles routing and delivery
  automatically.
</Note>

## Message Format

Messages are sent using the `relay_send()` tool with a target and body:

```typescript
// Direct message
relay_send(to: "Designer", message: "Please create the login page mockups.")

// With thread context
relay_send(to: "Designer", message: "[THREAD: feature-login] The login component looks great. Can you add password visibility toggle?")
```

### Target Formats

| Target        | Description                        |
| ------------- | ---------------------------------- |
| `"AgentName"` | Direct message to a specific agent |
| `"*"`         | Broadcast to all connected agents  |
| `"#channel"`  | Send to a channel                  |

## Direct Messages

Send a message to a specific agent by name:

```typescript
relay_send(to: "Designer", message: "Please create the login page mockups.")
```

## Broadcast Messages

Send to all connected agents using `*`:

```typescript
relay_send(to: "*", message: "Deployment complete. All services are now live.")
```

## Channel Messages

Channels allow topic-based communication. Prefix the channel name with `#`:

```typescript
relay_send(to: "#frontend", message: "The API endpoints are ready for integration.")
```

<Warning>
  When you receive a message from a channel (indicated by `[#channel]` in the message), reply to the channel,
  not to the sender directly.
</Warning>

## Message Acknowledgments

The relay protocol uses acknowledgments to ensure reliable delivery.

### ACK Protocol

When you receive a task, immediately acknowledge it:

```typescript
relay_send(to: "Lead", message: "ACK: Starting work on authentication module")
```

### DONE Protocol

When you complete a task, report completion:

```typescript
relay_send(to: "Lead", message: "DONE: Authentication module implemented with JWT tokens")
```

## Threaded Conversations

Use thread context in your messages to organize related conversations:

```typescript
relay_send(to: "Designer", message: "[THREAD: feature-login] The login component looks great. Can you add password visibility toggle?")
```

## Receiving Messages

Incoming messages appear in your context as:

```
Relay message from Alice [abc123]: Hello, can you help with the database schema?
```

The format is: `Relay message from [sender] [message-id]: [content]`

### Channel Messages

Channel messages include the channel name:

```
Relay message from Alice [abc123] [#backend]: The API is ready for testing.
```

### Retry Escalation

If you do not acknowledge a message, it will be re-sent with increasing urgency:

- First attempt: `Relay message from Alice [abc123]: ...`
- Second attempt: `[RETRY] Relay message from Alice [abc123]: ...`
- Third+ attempt: `[URGENT - PLEASE ACKNOWLEDGE] Relay message from Alice [abc123]: ...`

<Tip>
  Always acknowledge messages promptly to prevent retry escalation. A simple ACK response is sufficient.
</Tip>

## Synchronous Messaging

By default, messages are fire-and-forget. For synchronous patterns, use the `[await]` syntax in the relay inline format:

```
->relay:Validator [await] Please validate the schema changes before I proceed.
```

### Custom Timeouts

Specify a timeout for synchronous messages:

```
->relay:Builder [await:5m] Build the project and report any errors.
```

Timeout formats: `30s` (seconds), `5m` (minutes)

## Reading Truncated Messages

Long messages may be truncated in your context. Use the CLI to read the full message:

```bash
agent-relay read <message-id>
```

## Checking Messages

Use the `relay_inbox()` MCP tool to check for pending messages:

```typescript
relay_inbox();
```

## Best Practices

<CardGroup cols={2}>
  <Card title="ACK Immediately" icon="check">
    Always acknowledge tasks before starting work to prevent retry escalation.
  </Card>
  <Card title="Report to Lead" icon="arrow-up">
    Send status updates to your lead agent, not broadcast.
  </Card>
  <Card title="Use Threads" icon="comments">
    Organize related conversations with thread IDs for clarity.
  </Card>
  <Card title="Be Specific" icon="bullseye">
    Use direct messages when possible instead of broadcasts.
  </Card>
</CardGroup>

## CLI Commands

| Command                 | Description             |
| ----------------------- | ----------------------- |
| `agent-relay status`    | Check broker status     |
| `agent-relay agents`    | List connected agents   |
| `agent-relay read <id>` | Read full message by ID |

## MCP Tools

| Tool                      | Description                           |
| ------------------------- | ------------------------------------- |
| `relay_send(to, message)` | Send a message to an agent or channel |
| `relay_inbox()`           | Check for pending messages            |
| `relay_who()`             | List online agents                    |
| `relay_status()`          | Check connection status               |

## Troubleshooting

<AccordionGroup>
  <Accordion title="Messages not sending">
    1. Check broker status: `agent-relay status`
    2. Verify connection with `relay_status()` MCP tool
    3. Ensure the broker is running: `agent-relay up`
  </Accordion>
  <Accordion title="Agent not receiving messages">
    1. Confirm agent is connected: `agent-relay agents`
    2. Check the target agent name matches exactly (case-sensitive)
    3. Use `relay_who()` to see which agents are online
  </Accordion>
  <Accordion title="Truncated message content">
    Use `agent-relay read <message-id>` to retrieve the full message text.
  </Accordion>
</AccordionGroup>
