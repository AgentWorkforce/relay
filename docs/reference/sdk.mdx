---
title: SDK Reference
description: Complete reference for the @agent-relay/sdk package
---

# SDK Reference

```bash
npm install @agent-relay/sdk
```

---

## AgentRelay

The main entry point. Manages the broker lifecycle, spawns agents, and routes messages.

```typescript
import { AgentRelay } from '@agent-relay/sdk';

const relay = new AgentRelay(options?: AgentRelayOptions);
```

### AgentRelayOptions

| Property             | Type                  | Description                                                   | Default              |
| -------------------- | --------------------- | ------------------------------------------------------------- | -------------------- |
| `binaryPath`         | `string`              | Path to the broker binary                                     | Auto-resolved        |
| `binaryArgs`         | `string[]`            | Extra arguments for the broker process                        | None                 |
| `brokerName`         | `string`              | Name for the broker instance                                  | Auto-generated       |
| `channels`           | `string[]`            | Default channels agents are joined to on spawn                | `['general']`        |
| `cwd`                | `string`              | Working directory for the broker and spawned agents           | `process.cwd()`      |
| `env`                | `NodeJS.ProcessEnv`   | Environment variables passed to the broker                    | Inherited            |
| `requestTimeoutMs`   | `number`              | Timeout for broker requests                                   | `30000`              |
| `shutdownTimeoutMs`  | `number`              | Timeout when shutting down                                    | `10000`              |
| `workspaceName`      | `string`              | Name for the auto-created Relaycast workspace                 | Random               |
| `relaycastBaseUrl`   | `string`              | Base URL for the Relaycast API                                | `https://api.relaycast.dev` |

---

## Spawning Agents

### Shorthand Spawners

```typescript
// Spawn by CLI type
const agent = await relay.claude.spawn(options?)
const agent = await relay.codex.spawn(options?)
const agent = await relay.gemini.spawn(options?)
```

**Spawn options:**

| Property   | Type       | Description                           |
| ---------- | ---------- | ------------------------------------- |
| `name`     | `string`   | Agent name (defaults to CLI name)     |
| `model`    | `string`   | Model to use (see Models below)       |
| `task`     | `string`   | Initial task / prompt                 |
| `channels` | `string[]` | Channels to join                      |
| `args`     | `string[]` | Extra CLI arguments                   |
| `cwd`      | `string`   | Working directory override            |

### `relay.spawn(name, cli, task?, options?)`

Spawn any CLI by name:

```typescript
const agent = await relay.spawn('Worker', 'claude', 'Help with refactoring', {
  model: Models.Claude.SONNET,
  channels: ['team'],
});
```

### `relay.spawnAndWait(name, cli, task, options?)`

Spawn and wait for the agent to be ready before returning:

```typescript
const agent = await relay.spawnAndWait('Worker', 'claude', 'Analyze the codebase', {
  timeoutMs: 30000,
  waitForMessage: false, // true = wait for first message, false = wait for process ready
});
```

---

## Agent

All spawn methods return an `Agent`:

```typescript
interface Agent {
  readonly name: string;
  readonly runtime: AgentRuntime;
  readonly channels: string[];
  readonly status: AgentStatus; // 'spawning' | 'ready' | 'idle' | 'exited'
  exitCode?: number;
  exitSignal?: string;
  exitReason?: string;

  sendMessage(input: {
    to: string;
    text: string;
    threadId?: string;
    priority?: number;
    data?: Record<string, unknown>;
  }): Promise<Message>;

  release(reason?: string): Promise<void>;
  waitForReady(timeoutMs?: number): Promise<void>;
  waitForExit(timeoutMs?: number): Promise<'exited' | 'timeout' | 'released'>;
  waitForIdle(timeoutMs?: number): Promise<'idle' | 'timeout' | 'exited'>;
  onOutput(callback: (chunk: string) => void): () => void; // returns unsubscribe
}
```

---

## Human Handles

Send messages from a named human or system identity (not a spawned CLI agent):

```typescript
// Named human
const human = relay.human({ name: 'Orchestrator' });
await human.sendMessage({ to: 'Worker', text: 'Start the task' });

// System identity (name: "system")
const sys = relay.system();
await sys.sendMessage({ to: 'Worker', text: 'Stop and report status' });

// Broadcast to all agents
await relay.broadcast('All hands: stand by for new task');
```

---

## Event Hooks

Assign a function to subscribe, `null` to unsubscribe:

```typescript
relay.onMessageReceived = (msg: Message) => { ... }
relay.onMessageSent    = (msg: Message) => { ... }
relay.onAgentSpawned   = (agent: Agent) => { ... }
relay.onAgentReleased  = (agent: Agent) => { ... }
relay.onAgentExited    = (agent: Agent) => { ... }
relay.onAgentReady     = (agent: Agent) => { ... }
relay.onAgentIdle      = ({ name, idleSecs }) => { ... }
relay.onAgentExitRequested = ({ name, reason }) => { ... }
relay.onWorkerOutput   = ({ name, stream, chunk }) => { ... }
relay.onDeliveryUpdate = (event: BrokerEvent) => { ... }
```

**Message type:**

```typescript
interface Message {
  eventId: string;
  from: string;
  to: string;
  text: string;
  threadId?: string;
  data?: Record<string, unknown>;
}
```

---

## Other Methods

```typescript
// List all known agents
const agents = await relay.listAgents(): Promise<Agent[]>

// Get broker status
const status = await relay.getStatus(): Promise<BrokerStatus>

// Read last N lines of an agent's log file
const logs = await relay.getLogs('Worker', { lines: 100 })
// logs.found: boolean, logs.content: string

// List agents that have log files
const names = await relay.listLoggedAgents(): Promise<string[]>

// Stream an agent's log file (returns handle with .unsubscribe())
const handle = relay.followLogs('Worker', {
  historyLines: 50,
  onEvent(event) {
    if (event.type === 'log') console.log(event.content);
  },
})
handle.unsubscribe();

// Wait for the first of many agents to exit
const { agent, result } = await AgentRelay.waitForAny([agent1, agent2], 60000)

// Shut down all agents and the broker
await relay.shutdown()
```

---

## Complete Example

```typescript
import { AgentRelay, Models } from '@agent-relay/sdk';

const relay = new AgentRelay();

relay.onMessageReceived = (msg) => {
  console.log(`${msg.from} → ${msg.to}: ${msg.text}`);
};

relay.onAgentSpawned = (agent) => {
  console.log(`Spawned: ${agent.name}`);
};

// Spawn agents
const planner = await relay.claude.spawn({
  name: 'Planner',
  model: Models.Claude.OPUS,
  task: 'Plan the feature implementation',
});

const coder = await relay.codex.spawn({
  name: 'Coder',
  model: Models.Codex.GPT_5_3_CODEX,
  task: 'Implement the plan',
});

// Wait for both to be ready
await planner.waitForReady();
await coder.waitForReady();

// Send a message
await planner.sendMessage({ to: 'Coder', text: 'Start implementing the auth module' });

// Wait for coder to finish
await coder.waitForExit(300_000);

await relay.shutdown();
```

---

## Models

```typescript
import { Models } from '@agent-relay/sdk';

// Claude
Models.Claude.OPUS    // 'opus'
Models.Claude.SONNET  // 'sonnet'
Models.Claude.HAIKU   // 'haiku'

// Codex
Models.Codex.GPT_5_3_CODEX       // 'gpt-5.3-codex'
Models.Codex.GPT_5_2_CODEX       // 'gpt-5.2-codex' (default)
Models.Codex.GPT_5_3_CODEX_SPARK // 'gpt-5.3-codex-spark'
Models.Codex.GPT_5_1_CODEX_MAX   // 'gpt-5.1-codex-max'
Models.Codex.GPT_5_1_CODEX_MINI  // 'gpt-5.1-codex-mini'

// Gemini
Models.Gemini.GEMINI_2_5_PRO      // 'gemini-2.5-pro' (default)
Models.Gemini.GEMINI_2_5_FLASH    // 'gemini-2.5-flash'
Models.Gemini.GEMINI_2_5_FLASH_LITE // 'gemini-2.5-flash-lite'
Models.Gemini.GEMINI_3_PRO_PREVIEW  // 'gemini-3-pro-preview'
```

---

## Error Types

```typescript
import { AgentRelayProtocolError, AgentRelayProcessError } from '@agent-relay/sdk';

try {
  await relay.claude.spawn({ name: 'Worker' });
} catch (err) {
  if (err instanceof AgentRelayProtocolError) {
    // Broker returned an error response (err.code available)
  }
  if (err instanceof AgentRelayProcessError) {
    // Broker process failed to start or crashed
  }
}
```

---

## Subpath Exports

| Import path                   | Contents                               |
| ----------------------------- | -------------------------------------- |
| `@agent-relay/sdk`            | Everything (AgentRelay, Models, types) |
| `@agent-relay/sdk/client`     | AgentRelayClient (low-level)           |
| `@agent-relay/sdk/protocol`   | Protocol types and constants           |
| `@agent-relay/sdk/workflows`  | workflow(), WorkflowRunner, SwarmPatterns |
| `@agent-relay/sdk/browser`    | Protocol types for browser environments (no Node.js deps) |
| `@agent-relay/sdk/logs`       | Log file utilities                     |
| `@agent-relay/sdk/consensus`  | Consensus types and helpers            |
| `@agent-relay/sdk/shadow`     | Shadow agent types                     |

---

## See Also

- [Quickstart](/quickstart) — Spawn agents and exchange messages quickly
