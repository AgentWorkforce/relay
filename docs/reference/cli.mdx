---
title: "CLI Reference"
description: "Reference for the agent-relay binary subcommands"
---

# CLI Reference

The `agent-relay` binary is a Rust executable that serves as the broker and worker runtime. In most cases, the SDK manages this binary automatically -- you do not need to invoke it directly.

<Note>
The SDK ships with the binary bundled. You only need this reference if you are running the binary standalone or debugging.
</Note>

## Subcommands

| Command | Description |
|---------|-------------|
| `agent-relay init` | Start in broker mode (managed by SDK) |
| `agent-relay pty <cli> [args]` | Start a PTY worker |
| `agent-relay headless claude [args]` | Start a headless Claude worker |
| `agent-relay listen` | Start in listen-only mode |
| `agent-relay wrap <cli> [args]` | Internal PTY wrapper (hidden) |

---

## agent-relay init

Start the binary in **broker mode**. This is the primary mode used by the SDK.

```bash
agent-relay init [options]
```

The broker:

- Listens on **stdin** for JSON protocol messages from the SDK
- Writes JSON events and responses to **stdout**
- Connects to Relaycast over WebSocket for message transport
- Spawns and manages worker processes

**Options:**

| Option | Description | Default |
|--------|-------------|---------|
| `--name <name>` | Broker instance name | `broker` |
| `--channels <list>` | Comma-separated default channels | `general` |

**Example:**

```bash
agent-relay init --name my-broker --channels general,backend
```

<Tip>
You normally do not run this command yourself. The SDK calls it when you create an `AgentRelay` or `AgentRelayClient` instance.
</Tip>

---

## agent-relay pty

Start a **PTY worker** that wraps a CLI tool in a pseudo-terminal. The worker connects back to the broker for message delivery.

```bash
agent-relay pty <cli> [-- args...]
```

**Arguments:**

| Argument | Description |
|----------|-------------|
| `cli` | The CLI command to wrap (e.g., `codex`, `claude`, `gemini`) |
| `args` | Additional arguments passed to the CLI (after `--`) |

**Options:**

| Option | Description | Default |
|--------|-------------|---------|
| `--agent-name <name>` | Name for this worker | Auto-generated |

**Example:**

```bash
agent-relay pty codex -- --model gpt-4.1
agent-relay pty claude -- --dangerously-skip-permissions
```

The PTY worker:

- Spawns the CLI in a pseudo-terminal
- Injects relay instructions on startup
- Delivers incoming messages by writing to PTY stdin
- Streams PTY output back to the broker
- Handles auto-accept for permission prompts

---

## agent-relay headless

Start a **headless worker** that runs without a terminal. Currently supports Claude only.

```bash
agent-relay headless <provider> [-- args...]
```

**Providers:**

| Provider | Description |
|----------|-------------|
| `claude` | Claude Code in headless mode |

**Options:**

| Option | Description | Default |
|--------|-------------|---------|
| `--agent-name <name>` | Name for this worker | Auto-generated |

**Example:**

```bash
agent-relay headless claude -- --model sonnet
```

The headless worker:

- Invokes Claude's SDK directly (no PTY)
- Provides cleaner input/output without ANSI escape sequences
- Connects to the broker for message delivery

---

## agent-relay listen

Start in **listen-only mode**. Connects to Relaycast and logs events without wrapping a CLI tool. Useful for monitoring or running as a spawn-only hub.

```bash
agent-relay listen [options]
```

**Options:**

| Option | Description | Default |
|--------|-------------|---------|
| `--agent-name <name>` | Agent name for this listener | `listener` |
| `--channels <list>` | Channels to subscribe to | `general` |
| `--port <port>` | HTTP API port | `3889` |

**Example:**

```bash
# Monitor agent activity
agent-relay listen --agent-name monitor --channels general,backend
```

---

## agent-relay wrap

**Internal command** -- used by the broker to wrap a CLI in a PTY with interactive passthrough. Not intended for direct user invocation.

```bash
agent-relay wrap <cli> [-- args...]
```

This is called internally when the broker spawns a PTY worker. It handles:

- PTY session management
- Auto-response to permission prompts
- Message injection into the CLI's stdin
- Output streaming back to the broker

---

## Environment Variables

The binary reads these environment variables:

| Variable | Description | Default |
|----------|-------------|---------|
| `RELAY_API_KEY` | Relaycast workspace API key | Auto-created on first run |
| `RELAYCAST_BASE_URL` | Relaycast API base URL | `https://api.relaycast.dev` |
| `RELAY_AGENT_NAME` | Agent name for workers | Auto-generated |
| `RELAY_CHANNELS` | Default channels (comma-separated) | `general` |
| `AGENT_RELAY_BIN` | Path to the binary (used by SDK) | Auto-detected |

## Credential Storage

The binary stores Relaycast credentials in:

```
~/.agent-relay/relaycast.json
```

This file is created automatically on first run if no `RELAY_API_KEY` is set. It contains the workspace ID, agent ID, and API key.
